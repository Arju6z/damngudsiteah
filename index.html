<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SYSTEM // VOID</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Inter,system-ui,sans-serif}
body{background:#000;color:#d0d0d0;overflow:hidden;height:100vh}

canvas{position:fixed;inset:0}

/* Film grain */
#grain{pointer-events:none;opacity:.06;mix-blend-mode:overlay}

/* Cursor */
#cursor{
  position:fixed;
  width:14px;height:14px;
  border-radius:50%;
  background:#fff;
  mix-blend-mode:difference;
  pointer-events:none;
  transform:translate(-50%,-50%);
}

/* Text */
#overlay{
  position:fixed;inset:0;
  display:flex;align-items:center;justify-content:center;
  pointer-events:none;
}
#text{
  text-align:center;
  font-size:13px;
  letter-spacing:.2em;
  text-transform:uppercase;
  opacity:0;
  transition:opacity 3s ease;
}

/* Glitch */
.glitch{
  animation:glitch .25s steps(2,end) infinite;
}
@keyframes glitch{
  0%{transform:translate(0,0)}
  25%{transform:translate(-2px,1px)}
  50%{transform:translate(2px,-1px)}
  75%{transform:translate(-1px,2px)}
  100%{transform:translate(0,0)}
}
</style>
</head>

<body>

<canvas id="void"></canvas>
<canvas id="grain"></canvas>
<div id="cursor"></div>

<div id="overlay"><div id="text"></div></div>

<script>
/* =========================
   SYSTEM STATE
========================= */
const SYSTEM = {
  time: 0,
  phase: 0,
  interacted: false,
  proximityHits: 0,
  memory: sessionStorage.getItem("void_seen") ? true : false
};
sessionStorage.setItem("void_seen", "1");

/* =========================
   VOID ENGINE
========================= */
const c = document.getElementById("void");
const ctx = c.getContext("2d");
resize();

let stars = Array.from({length:400},()=>({
  x:Math.random()*c.width,
  y:Math.random()*c.height,
  z:Math.random(),
  v:Math.random()*0.25+0.05
}));

function drawVoid(){
  ctx.clearRect(0,0,c.width,c.height);
  stars.forEach(s=>{
    s.y+=s.v*(1+s.z*2);
    if(s.y>c.height){s.y=0;s.x=Math.random()*c.width}
    ctx.fillStyle=`rgba(255,255,255,${0.15+s.z*0.7})`;
    ctx.fillRect(s.x,s.y,1+s.z,1+s.z);
  });
  requestAnimationFrame(drawVoid);
}
drawVoid();

/* =========================
   FILM GRAIN
========================= */
const g = document.getElementById("grain");
const gctx = g.getContext("2d");
resize();
(function grainLoop(){
  const img = gctx.createImageData(g.width,g.height);
  for(let i=0;i<img.data.length;i+=4){
    const v=Math.random()*255;
    img.data[i]=img.data[i+1]=img.data[i+2]=v;
    img.data[i+3]=18;
  }
  gctx.putImageData(img,0,0);
  requestAnimationFrame(grainLoop);
})();

/* =========================
   CURSOR ENTITY
========================= */
const cursor = document.getElementById("cursor");
let cx=innerWidth/2, cy=innerHeight/2, tx=cx, ty=cy;

window.addEventListener("mousemove",e=>{
  tx=e.clientX; ty=e.clientY;
  SYSTEM.interacted=true;
});

(function moveCursor(){
  cx+=(tx-cx)*0.06;
  cy+=(ty-cy)*0.06;
  cursor.style.left=cx+"px";
  cursor.style.top=cy+"px";
  requestAnimationFrame(moveCursor);
})();

/* =========================
   TEXT ENGINE
========================= */
const text = document.getElementById("text");

function say(msg, glitch=false){
  text.textContent=msg;
  text.style.opacity=1;
  text.classList.toggle("glitch",glitch);
}

/* =========================
   PROXIMITY ZONES
========================= */
const zones = [
  {x:0.25,y:0.3,r:120},
  {x:0.7,y:0.6,r:140}
];

function checkZones(){
  zones.forEach(z=>{
    const zx=z.x*innerWidth;
    const zy=z.y*innerHeight;
    const d=Math.hypot(cx-zx,cy-zy);
    if(d<z.r){
      SYSTEM.proximityHits++;
      if(SYSTEM.proximityHits===1) say("YOU NOTICED",true);
      if(SYSTEM.proximityHits===3) say("THE SYSTEM NOTICED YOU",true);
    }
  });
}

/* =========================
   TIME / PHASE ENGINE
========================= */
setInterval(()=>{
  SYSTEM.time++;

  if(SYSTEM.time===6) say("INITIALIZING");
  if(SYSTEM.time===15) say("SIGNAL CONFIRMED");
  if(SYSTEM.time===30 && !SYSTEM.interacted) say("PASSIVE OBSERVER");
  if(SYSTEM.time===30 && SYSTEM.interacted) say("ACTIVE PRESENCE");

  if(SYSTEM.time===50){
    SYSTEM.phase=1;
    say("ENTERING PHASE TWO");
  }

  if(SYSTEM.time===75 && SYSTEM.proximityHits>0){
    say("YOU ARE SEARCHING");
  }

  if(SYSTEM.time===100){
    say("THE SYSTEM IS AWARE",true);
    document.body.classList.add("glitch");
  }

  checkZones();
},1000);

/* =========================
   RESIZE
========================= */
function resize(){
  c.width=g.width=innerWidth;
  c.height=g.height=innerHeight;
}
window.addEventListener("resize",resize);
</script>

</body>
</html>
